CREATE PROCEDURE [dbo].[ProcedurePayOrder]
    @OrderID INT,
    @PaidAmount DECIMAL(10, 2)
AS
BEGIN
    SET NOCOUNT ON;

    -- Sprawdzamy, czy zamówienie o podanym ID istnieje
    IF EXISTS (SELECT 1 FROM [Order] WHERE ID = @OrderID)
    BEGIN
        -- Sprawdzamy, czy zamówienie nie jest opłacone
        IF NOT EXISTS (SELECT 1 FROM [Order] WHERE ID = @OrderID AND isPayed = 1)
        BEGIN
            -- Sprawdzamy, czy podana kwota jest wystarczająca do opłacenia zamówienia
            IF @PaidAmount = (SELECT SUM(Price  Amount) FROM OrderPosition WHERE OrderID = @OrderID)
            BEGIN
                -- Aktualizujemy zamówienie jako opłacone
                UPDATE [Order]
                SET isPayed = 1
                WHERE ID = @OrderID

                PRINT 'Zamówienie zostało opłacone.'
            END
            ELSE
            BEGIN
                -- Jeśli podana kwota nie wystarcza do opłacenia zamówienia, wyświetlamy komunikat
                PRINT 'Podana kwota jest niewystarczająca do opłacenia zamówienia.'
            END
        END
        ELSE
        BEGIN
            -- Jeśli zamówienie jest już opłacone, wyświetlamy odpowiedni komunikat
            PRINT 'Zamówienie jest już opłacone.'
        END
    END
    ELSE
    BEGIN
        -- Jeśli zamówienie o podanym ID nie istnieje, wyświetlamy odpowiedni komunikat
        PRINT 'Zamówienie o podanym ID nie istnieje.'
    END
END;